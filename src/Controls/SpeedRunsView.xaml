<UserControl x:Class="LightsOutCube.Controls.SpeedRunsView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:models="clr-namespace:LightsOutCube.ViewModels"
             xmlns:local="clr-namespace:LightsOutCube.Controls"
             Background="Transparent">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <!-- Column headings aligned with item template -->
        <Grid Grid.Row="0" Margin="4,0,4,6">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="40"/>
                <ColumnDefinition Width="60"/>
                <ColumnDefinition Width="50"/>
                <ColumnDefinition Width="90"/>
                <ColumnDefinition Width="130"/>
            </Grid.ColumnDefinitions>
            <TextBlock Grid.Column="0"  Grid.Row="0" Text="Rank" Foreground="White" FontWeight="SemiBold" />
            <TextBlock Grid.Column="1"  Grid.Row="0" Text="Solved" Foreground="White" FontWeight="SemiBold" />
            <TextBlock Grid.Column="2"  Grid.Row="0" Text="Total" Foreground="White" FontWeight="SemiBold" />
            <TextBlock Grid.Column="3"  Grid.Row="0" Text="Last Puzzle" Foreground="White" FontWeight="SemiBold" />
            <TextBlock Grid.Column="4"  Grid.Row="0" Text="When" Foreground="White" FontWeight="SemiBold" />
        </Grid>
        <TreeView x:Name="PART_TreeView"
                  ItemsSource="{Binding ItemsSource, RelativeSource={RelativeSource AncestorType=UserControl}}"
                  Background="Transparent" Foreground="White" BorderThickness="0"
                  Grid.Row="1"
                  ScrollViewer.HorizontalScrollBarVisibility="Auto"
                  ScrollViewer.VerticalScrollBarVisibility="Auto"
                  ScrollViewer.CanContentScroll="False">
                <TreeView.Resources>
                    <Style TargetType="TreeViewItem">
                        <Setter Property="Foreground" Value="White"/>
                        <Setter Property="Background" Value="Transparent"/>
                        <Setter Property="Margin" Value="0,0,0,4"/>
                    </Style>

                    <!-- Top-level run template -->
                    <HierarchicalDataTemplate DataType="{x:Type models:SpeedRunEntryWrapper}" ItemsSource="{Binding PuzzleTimes}">
                        <Border x:Name="RootBorder" Padding="4" Background="Transparent" CornerRadius="4">
                            <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="35"/>
                                <ColumnDefinition Width="55"/>
                                <ColumnDefinition Width="45"/>
                                <ColumnDefinition Width="80"/>
                                <ColumnDefinition Width="100"/>
                            </Grid.ColumnDefinitions>
                                <TextBlock x:Name="RankText" Grid.Column="0" Text="{Binding Rank}" />
                                <TextBlock x:Name="SolvedText" Grid.Column="1" Text="{Binding SolvedCount}" />
                                <TextBlock x:Name="TotalTimeText" Grid.Column="2" Text="{Binding TotalTime}" />
                                <TextBlock x:Name="LastPuzzleText" Grid.Column="3" Text="{Binding LastPuzzle}" />
                                <TextBlock x:Name="TimestampText" Grid.Column="4" Text="{Binding Timestamp}" />
                            </Grid>
                        </Border>
                        <HierarchicalDataTemplate.Triggers>
                            <DataTrigger Binding="{Binding IsLatest}" Value="True">
                                <Setter TargetName="RootBorder" Property="Background" Value="#FF2A9DF4" />
                                <Setter TargetName="RankText" Property="FontWeight" Value="Bold" />
                                <Setter TargetName="SolvedText" Property="FontWeight" Value="Bold" />
                                <Setter TargetName="TotalTimeText" Property="FontWeight" Value="Bold" />
                                <Setter TargetName="LastPuzzleText" Property="FontWeight" Value="Bold" />
                                <Setter TargetName="TimestampText" Property="FontWeight" Value="Bold" />
                            </DataTrigger>
                        </HierarchicalDataTemplate.Triggers>
                    </HierarchicalDataTemplate>

                    <!-- Child item template for per-puzzle time details -->
                    <DataTemplate DataType="{x:Type models:PuzzleTimeEntry}">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="50" />
                                <ColumnDefinition Width="60" />
                                <ColumnDefinition Width="60" />
                                <ColumnDefinition Width="50" />
                            </Grid.ColumnDefinitions>

                            <!-- Data row: hidden when IsHeader == true -->
                            <TextBlock Grid.Column="0" Margin="8,2,2,2" Text="{Binding Index}">
                                <TextBlock.Style>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="Visibility" Value="Visible" />
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding IsHeader}" Value="True">
                                                <Setter Property="Visibility" Value="Collapsed" />
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </TextBlock.Style>
                            </TextBlock>
                            <TextBlock Grid.Column="1" Margin="8,2,2,2" Text="{Binding Time}">
                                <TextBlock.Style>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="Visibility" Value="Visible" />
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding IsHeader}" Value="True">
                                                <Setter Property="Visibility" Value="Collapsed" />
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </TextBlock.Style>
                            </TextBlock>
                            <TextBlock Grid.Column="2" Margin="8,2,2,2" Text="{Binding PressCount}">
                                <TextBlock.Style>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="Visibility" Value="Visible" />
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding IsHeader}" Value="True">
                                                <Setter Property="Visibility" Value="Collapsed" />
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </TextBlock.Style>
                            </TextBlock>
                            <TextBlock Grid.Column="3" Margin="8,2,2,2" Text="{Binding PerfectText}">
                                <TextBlock.Style>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="Visibility" Value="Visible" />
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding IsHeader}" Value="True">
                                                <Setter Property="Visibility" Value="Collapsed" />
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </TextBlock.Style>
                            </TextBlock>

                            <!-- Header row: visible only when IsHeader == true -->
                            <TextBlock Grid.Column="0" Margin="8,2,2,2" Text="Puzzle" FontWeight="SemiBold">
                                <TextBlock.Style>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="Visibility" Value="Collapsed" />
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding IsHeader}" Value="True">
                                                <Setter Property="Visibility" Value="Visible" />
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </TextBlock.Style>
                            </TextBlock>
                            <TextBlock Grid.Column="1" Margin="8,2,2,2" Text="Time" FontWeight="SemiBold">
                                <TextBlock.Style>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="Visibility" Value="Collapsed" />
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding IsHeader}" Value="True">
                                                <Setter Property="Visibility" Value="Visible" />
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </TextBlock.Style>
                            </TextBlock>
                            <TextBlock Grid.Column="2" Margin="8,2,2,2" Text="Buttons" FontWeight="SemiBold">
                                <TextBlock.Style>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="Visibility" Value="Collapsed" />
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding IsHeader}" Value="True">
                                                <Setter Property="Visibility" Value="Visible" />
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </TextBlock.Style>
                            </TextBlock>
                            <TextBlock Grid.Column="3" Margin="8,2,2,2" Text="Perfect" FontWeight="SemiBold">
                                <TextBlock.Style>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="Visibility" Value="Collapsed" />
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding IsHeader}" Value="True">
                                                <Setter Property="Visibility" Value="Visible" />
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </TextBlock.Style>
                            </TextBlock>
                        </Grid>
                    </DataTemplate>
                </TreeView.Resources>

                <TreeView.Template>
                    <ControlTemplate TargetType="TreeView">
                        <Border Background="{TemplateBinding Background}">
                            <ScrollViewer Focusable="false" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Auto" CanContentScroll="False">
                                <ItemsPresenter />
                            </ScrollViewer>
                        </Border>
                    </ControlTemplate>
                </TreeView.Template>
            </TreeView>
    </Grid>
</UserControl>
